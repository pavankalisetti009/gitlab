import { shallowMount } from '@vue/test-utils';
import { GlAlert } from '@gitlab/ui';
import VulnerabilityRetentionAlert from 'ee/security_dashboard/components/shared/vulnerability_retention_alert.vue';

describe('Vulnerability retention alert component', () => {
  let wrapper;

  const createComponent = ({ showRetentionAlert = false } = {}) => {
    wrapper = shallowMount(VulnerabilityRetentionAlert, {
      provide: {
        showRetentionAlert,
      },
    });
  };

  const findAlert = () => wrapper.findComponent(GlAlert);

  it.each`
    showRetentionAlert
    ${true}
    ${false}
  `(
    'displays the alert when showRetentionAlert is $showRetentionAlert',
    ({ showRetentionAlert }) => {
      createComponent({ showRetentionAlert });
      expect(findAlert().exists()).toBe(showRetentionAlert);
    },
  );

  it('displays the correct title for the alert', () => {
    createComponent({ showRetentionAlert: true });
    expect(findAlert().props('title')).toBe('Coming soon: retention policies');
  });

  it('displays the correct content for the alert', () => {
    createComponent({ showRetentionAlert: true });
    expect(findAlert().text()).toBe(
      'Starting 2025-05-15, vulnerabilities that have not been updated in the last 12 months will automatically move the vulnerability archive for 3 years before deletion. To access the archive, on the left sidebar, select Secure > Security Configuration > Vulnerability Management.',
    );
  });
});
