import { GlExperimentBadge } from '@gitlab/ui';
import { shallowMountExtended } from 'helpers/vue_test_utils_helper';
import DetailsSectionListItem from 'ee/security_dashboard/components/shared/vulnerability_details_graphql/details_section_list_item.vue';

describe('ee/security_dashboard/components/shared/vulnerability_details_graphql/details_section_list_item.vue', () => {
  let wrapper;
  const findExperimentBadge = () => wrapper.findComponent(GlExperimentBadge);

  const defaultRequiredProps = {
    label: 'Description:',
  };

  const createComponent = (options = {}, additionalProps = {}) => {
    wrapper = shallowMountExtended(DetailsSectionListItem, {
      propsData: {
        ...defaultRequiredProps,
        ...additionalProps,
      },
      ...options,
    });
  };

  it('renders the label within a `strong` tag', () => {
    createComponent({});

    expect(wrapper.find('strong').text()).toContain(defaultRequiredProps.label);
  });

  it('renders content that gets passed to the default slot', () => {
    const defaultSlotContent = 'Critical Severity';
    createComponent({
      slots: {
        default: defaultSlotContent,
      },
    });

    expect(wrapper.html()).toContain(defaultSlotContent);
  });

  describe('experiment badge', () => {
    it('renders with type "beta" when shown', () => {
      createComponent({
        propsData: {
          showExperimentBadge: true,
        },
      });

      expect(findExperimentBadge().props('type')).toBe('beta');
    });

    it('does not render when showExperimentBadge is false', () => {
      createComponent({
        propsData: {
          showExperimentBadge: false,
        },
      });

      expect(findExperimentBadge().exists()).toBe(false);
    });
  });
});
