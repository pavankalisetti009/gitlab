import { nextTick } from 'vue';
import VulnerabilityEventsTriggerItem from 'ee/webhooks/components/vulnerability_events_trigger_item.vue';
import { shallowMountExtended } from 'helpers/vue_test_utils_helper';

describe('VulnerabilityEventsTriggerItem', () => {
  let wrapper;

  const createComponent = ({ props = {} } = {}) => {
    wrapper = shallowMountExtended(VulnerabilityEventsTriggerItem, {
      propsData: {
        initialVulnerabilityTrigger: true,
        ...props,
      },
    });
  };

  const findTrigger = () => wrapper.findByTestId('vulnerabilityEvents');

  it('renders Vulnerability Events trigger', () => {
    createComponent();

    expect(findTrigger().attributes('triggername')).toBe('vulnerabilityEvents');
    expect(findTrigger().props('value')).toBe(true);
  });

  it('updates when emits input event', async () => {
    createComponent();
    expect(findTrigger().props('value')).toBe(true);
    await findTrigger().vm.$emit('input', false);
    await nextTick();

    expect(findTrigger().props('value')).toBe(false);
  });
});
