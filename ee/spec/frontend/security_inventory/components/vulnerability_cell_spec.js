import { shallowMount } from '@vue/test-utils';
import VulnerabilityCell from 'ee/security_inventory/components/vulnerability_cell.vue';
import VulnerabilityIndicator from 'ee/security_inventory/components/vulnerability_indicator.vue';
import VulnerabilityPopover from 'ee/security_inventory/components/vulnerability_popover.vue';
import { subgroupsAndProjects } from '../mock_data';

const mockProject = subgroupsAndProjects.data.group.projects.nodes[0];
const mockTargetId = 'vulnerabilities-count-0';

describe('VulnerabilityCell', () => {
  let wrapper;

  const createComponent = (props = {}) => {
    wrapper = shallowMount(VulnerabilityCell, {
      propsData: {
        item: mockProject,
        index: 0,
        ...props,
      },
    });
  };

  beforeEach(() => {
    createComponent();
  });

  describe('rendering', () => {
    it('renders the vulnerability indicator with correct props', () => {
      const indicator = wrapper.findComponent(VulnerabilityIndicator);
      expect(indicator.exists()).toBe(true);
      expect(indicator.props('counts')).toEqual(mockProject.vulnerabilitySeveritiesCount);
    });

    it('renders the vulnerability popover with correct props', () => {
      const popover = wrapper.findComponent(VulnerabilityPopover);
      expect(popover.exists()).toBe(true);
      expect(popover.props()).toEqual({
        vulnerabilitySeveritiesCount: mockProject.vulnerabilitySeveritiesCount,
        webUrl: mockProject.webUrl,
        targetId: mockTargetId,
        isSubGroup: false,
      });
    });

    it('sets correct id on the indicator container', () => {
      const container = wrapper.find(`#${mockTargetId}`);
      expect(container.exists()).toBe(true);
    });
  });
});
