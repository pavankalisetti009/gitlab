# frozen_string_literal: true

require 'spec_helper'

RSpec.describe API::Entities::Security::VulnerabilityScanning::Finding, feature_category: :software_composition_analysis do
  let(:finding) { build_stubbed(:ci_reports_security_finding, :dependency_scanning) }
  let(:expected_formated_json) do
    {
      name: finding.name,
      description: finding.description,
      severity: finding.severity,
      solution: finding.solution,
      location: {
        file: finding.location.file_path,
        dependency: {
          package: { name: finding.location.package_name },
          version: finding.location.package_version
        }
      },
      identifiers: [
        {
          type: finding.identifiers.first.external_type,
          value: finding.identifiers.first.external_id,
          name: finding.identifiers.first.name,
          url: finding.identifiers.first.url
        }
      ],
      cvss_vectors: finding.cvss,
      links: finding.links,
      details: finding.details
    }
  end

  subject { described_class.new(finding).as_json }

  it 'format the finding as expected' do
    is_expected.to eq(expected_formated_json)
  end
end
