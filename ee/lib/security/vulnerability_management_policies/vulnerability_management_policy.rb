# frozen_string_literal: true

module Security
  module VulnerabilityManagementPolicies
    class VulnerabilityManagementPolicy < Security::BaseSecurityPolicy
      def actions
        (policy_content[:actions] || []).map do |action|
          Security::VulnerabilityManagementPolicies::Action.new(action)
        end
      end

      def rules
        policy_rules = policy_record
          .vulnerability_management_policy_rules
          .map(&:typed_content).map(&:deep_symbolize_keys) || []

        (policy_rules || []).map do |rule|
          Security::VulnerabilityManagementPolicies::Rule.new(rule)
        end
      end

      private

      def policy_content
        policy_record.policy_content
      end
    end
  end
end
