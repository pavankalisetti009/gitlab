# frozen_string_literal: true

module API
  module Entities
    module Security
      module VulnerabilityScanning
        class SbomScan < Grape::Entity
          include ::API::Helpers::RelatedResourcesHelpers

          expose :id

          expose :download_url do |sbom_scan|
            expose_url api_v4_jobs_sbom_scans_path({ id: sbom_scan.build_id, sbom_scan_id: sbom_scan.id })
          end

          expose :throttled, if: ->(_, options) { options[:throttled] } do |_, options|
            options[:throttled]
          end

          expose :project_throttling_resets_in, if: ->(_, options) { options[:throttled] } do |_, options|
            options[:project_throttling_resets_in]
          end

          expose :advisory_db_state, if: ->(_, options) { options[:advisory_db_state] } do |_, options|
            options[:advisory_db_state]
          end
        end
      end
    end
  end
end
