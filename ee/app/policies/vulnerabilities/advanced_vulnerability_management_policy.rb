# frozen_string_literal: true

module Vulnerabilities
  module AdvancedVulnerabilityManagementPolicy
    extend ActiveSupport::Concern

    included do
      condition(:can_access_vulnerability_es_features) do
        can?(:read_security_resource) &&
          ::Search::Elastic::VulnerabilityIndexingHelper.vulnerability_indexing_allowed? &&
          (::Feature.enabled?(:advanced_vulnerability_management, @subject) ||
            ::Feature.enabled?(:advanced_vulnerability_management, @user))
      end

      rule { can_access_vulnerability_es_features }.enable :access_advanced_vulnerability_management
    end
  end
end
