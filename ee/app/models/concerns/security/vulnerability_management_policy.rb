# frozen_string_literal: true

module Security
  module VulnerabilityManagementPolicy
    POLICY_LIMIT = 5

    def active_vulnerability_management_policies
      vulnerability_management_policy.select { |config| config[:enabled] }.first(POLICY_LIMIT)
    end

    def vulnerability_management_policy
      policy_by_type(:vulnerability_management_policy)
    end

    def match?(vulnerability)
      no_longer_detected_rules.any? { |rule| rule.match?(vulnerability) }
    end

    def no_longer_detected_rules
      vulnerability_management_policy_rules
        .undeleted
        .no_longer_detected
    end
  end
end
