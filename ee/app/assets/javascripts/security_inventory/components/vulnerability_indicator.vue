<script>
import { formatNumber } from '~/locale';
import { sum } from '~/lib/utils/number_utils';
import { SEVERITY_SEGMENTS, OTHER_SEVERITIES, SEVERITY_BACKGROUND_COLORS } from '../constants';
import SegmentedBar from './segmented_bar.vue';

export default {
  components: {
    SegmentedBar,
  },
  props: {
    counts: {
      type: Object,
      required: false,
      default: () => ({}),
    },
  },
  computed: {
    totalCount() {
      return [...SEVERITY_SEGMENTS, ...OTHER_SEVERITIES]
        .map((severity) => this.counts[severity] || 0)
        .reduce(sum, 0);
    },
    severitySegments() {
      return SEVERITY_SEGMENTS.map((severity) => ({
        class: SEVERITY_BACKGROUND_COLORS[severity],
        count: this.counts[severity] || 0,
      }));
    },
  },
  formatNumber,
};
</script>
<template>
  <div>
    <segmented-bar :segments="severitySegments" />
    <span class="gl-text-sm gl-text-status-neutral">
      {{ $options.formatNumber(totalCount) }}
    </span>
  </div>
</template>
