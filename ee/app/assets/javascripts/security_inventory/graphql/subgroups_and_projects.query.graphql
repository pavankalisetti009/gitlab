query SubgroupsAndProjects(
  $fullPath: ID!
  $subgroupsFirst: Int
  $subgroupsAfter: String
  $projectsFirst: Int
  $projectsAfter: String
  $search: String
  $hasSearch: Boolean!
  $namespaceId: NamespaceID!
  $vulnerabilityCountFilters: [VulnerabilityCountFilterInput!]
  $securityAnalyzerFilters: [AnalyzerFilterInput!]
) {
  group(fullPath: $fullPath) {
    id
    descendantGroups(
      includeParentDescendants: false
      first: $subgroupsFirst
      after: $subgroupsAfter
    ) @skip(if: $hasSearch) {
      pageInfo {
        hasNextPage
        endCursor
      }
      nodes {
        __typename
        id
        name
        descendantGroupsCount
        projectsCount
        path
        fullPath
        avatarUrl
        webUrl
        updatedAt
        analyzerStatuses {
          success
          failure
          notConfigured
          analyzerType
          updatedAt
        }
        vulnerabilityNamespaceStatistic {
          critical
          high
          low
          info
          medium
          unknown
          updatedAt
        }
      }
    }
    projects(
      first: $projectsFirst
      after: $projectsAfter
      search: $search
      includeSubgroups: $hasSearch
      includeArchived: false
    ) @skip(if: $hasSearch) {
      pageInfo {
        hasNextPage
        endCursor
      }
      nodes {
        __typename
        id
        name
        path
        fullPath
        avatarUrl
        webUrl
        updatedAt
        secretPushProtectionEnabled
        containerScanningForRegistryEnabled
        vulnerabilityStatistic {
          critical
          high
          low
          info
          medium
          unknown
          updatedAt
        }
        analyzerStatuses {
          status
          analyzerType
          lastCall
          buildId
          updatedAt
        }
        # @client cannot be combined with @include
        # resolver returns empty array if feature flag is disabled
        securityAttributes @client {
          nodes {
            id
            name
            color
          }
        }
      }
    }
  }
  namespaceSecurityProjects(
    namespaceId: $namespaceId
    vulnerabilityCountFilters: $vulnerabilityCountFilters
    securityAnalyzerFilters: $securityAnalyzerFilters
    first: $projectsFirst
    after: $projectsAfter
    search: $search
    includeSubgroups: true
  ) @include(if: $hasSearch) {
    edges {
      node {
        __typename
        id
        name
        path
        fullPath
        avatarUrl
        webUrl
        updatedAt
        secretPushProtectionEnabled
        containerScanningForRegistryEnabled
        vulnerabilityStatistic {
          critical
          high
          low
          info
          medium
          unknown
          updatedAt
        }
        analyzerStatuses {
          status
          analyzerType
          lastCall
          buildId
          updatedAt
        }
        # @client cannot be combined with @include
        # resolver returns empty array if feature flag is disabled
        securityAttributes @client {
          nodes {
            id
            name
            color
          }
        }
      }
    }
    pageInfo {
      hasNextPage
      endCursor
    }
  }
}
