<script>
import glFeatureFlagMixin from '~/vue_shared/mixins/gl_feature_flags_mixin';
import { ACTION_HUMANIZED_TEMPLATE, AUTO_DISMISS, OVERRIDE } from '../constants';
import OverrideAction from './override_rule.vue';
import DismissAction from './dismiss_action.vue';
import ResolvedAction from './resolved_action.vue';

export default {
  ACTION_HUMANIZED_TEMPLATE,
  components: {
    DismissAction,
    ResolvedAction,
    OverrideAction,
  },
  mixins: [glFeatureFlagMixin()],
  props: {
    actions: {
      type: Array,
      required: false,
      default: () => [],
    },
  },
  computed: {
    hasAutoDismissVulnerabilityPolicies() {
      return this.glFeatures.autoDismissVulnerabilityPolicies;
    },
    hasSecurityPoliciesSeverityCustomize() {
      return this.glFeatures.securityPoliciesSeverityCustomize;
    },
    action() {
      return this.actions[0];
    },
    type() {
      return this.action?.type;
    },
    isDismissType() {
      return this.type === AUTO_DISMISS;
    },
    isOverrideType() {
      return this.type === OVERRIDE;
    },
    showDismissAction() {
      return this.hasAutoDismissVulnerabilityPolicies && this.isDismissType;
    },
    showOverrideAction() {
      return this.hasSecurityPoliciesSeverityCustomize && this.isOverrideType;
    },
  },
  methods: {
    selectAction(action) {
      this.$emit('select', action);
    },
  },
};
</script>

<template>
  <dismiss-action v-if="showDismissAction" :action="action" @select="selectAction" />
  <override-action v-else-if="showOverrideAction" :action="action" @select="selectAction" />
  <resolved-action v-else />
</template>
