<script>
import { GlCollapsibleListbox, GlSprintf } from '@gitlab/ui';
import { s__ } from '~/locale';
import {
  ACTION_DISMISS_HUMANIZED_TEMPLATE,
  DISMISS_REASONS,
  ACCEPTABLE_RISK,
  ACTION_TYPES,
  AUTO_DISMISS,
} from '../constants';
import SectionLayout from '../../section_layout.vue';

export default {
  ACTION_DISMISS_HUMANIZED_TEMPLATE,
  TYPE_LABEL: ACTION_TYPES[AUTO_DISMISS],
  i18n: {
    reasonPlaceholder: s__('SecurityOrchestration|Select dismiss reason'),
  },
  name: 'DismissAction',
  components: {
    GlCollapsibleListbox,
    GlSprintf,
    SectionLayout,
  },
  props: {
    action: {
      type: Object,
      required: true,
    },
  },
  computed: {
    items() {
      return Object.entries(DISMISS_REASONS).map(([value, text]) => ({
        value,
        text,
      }));
    },
    dismissalReason() {
      return this.action?.dismissal_reason || ACCEPTABLE_RISK;
    },
    toggleText() {
      return DISMISS_REASONS[this.dismissalReason] || this.$options.i18n.reasonPlaceholder;
    },
  },
  methods: {
    selectReason(reason) {
      this.$emit('select', { ...this.action, dismissal_reason: reason });
    },
  },
};
</script>

<template>
  <section-layout :show-remove-button="false" content-classes="!gl-block">
    <template #content>
      <gl-sprintf :message="$options.ACTION_DISMISS_HUMANIZED_TEMPLATE">
        <template #bold="{ content }">
          <strong>{{ content }}</strong>
        </template>
        <template #reason>
          <gl-collapsible-listbox
            :selected="dismissalReason"
            :toggle-text="toggleText"
            :items="items"
            @select="selectReason"
          />
        </template>
      </gl-sprintf>
    </template>
  </section-layout>
</template>
