#import "./vulnerability_location.fragment.graphql"
#import "./severity_override.fragment.graphql"

# WARNING: Adding fields to this fragment may cause the vulnerability report to break!
#
# When querying 100 results (which is common in the vulnerability report), this fragment
# is at risk of exceeding the maximum GraphQL query complexity limit, causing queries to fail.
#
# Before adding new fields, please consider:
# - The impact on query complexity with large result sets
# - Whether the field is absolutely necessary for the vulnerability report
# - Alternative approaches to fetching the data
#
# Related issues/MRs which aim to provide a solution:
# - https://gitlab.com/gitlab-org/gitlab/-/issues/580838
# - https://gitlab.com/gitlab-org/gitlab/-/merge_requests/212671

fragment VulnerabilityFragment on Vulnerability {
  id
  title
  state
  severity
  detectedAt
  dismissalReason
  vulnerabilityPath
  resolvedOnDefaultBranch
  userNotesCount
  aiResolutionAvailable
  aiResolutionEnabled
  falsePositive @include(if: $vetEnabled)
  severityOverrides(first: 1) @include(if: $includeSeverityOverrides) {
    nodes {
      ...SeverityOverrideFragment
    }
  }
  hasRemediations
  issueLinks {
    nodes {
      id
      issue {
        id
        iid
        webUrl
        webPath
        title
        state
      }
    }
  }
  mergeRequest {
    id
    webUrl
    state
    iid
    author {
      id
      human
    }
  }
  identifiers {
    externalType
    name
  }
  location {
    ...VulnerabilityLocation
  }
  project {
    id
    nameWithNamespace
  }
  findingTokenStatus {
    id
    status
  }
  cvss {
    overallScore
    version
  }
  cveEnrichment {
    epssScore
    isKnownExploit
  }
  reportType
  scanner {
    id
    vendor
    name
  }
  archivalInformation {
    aboutToBeArchived
    expectedToBeArchivedOn
  }
  policyViolations @gl_introduced(version: "18.6.0")
  reachability
  aiWorkflows {
    nodes {
      workflowName
      workflow {
        id
        humanStatus
        status
        createdAt
      }
    }
  }
  latestFlag @include(if: $includeLatestFlag) {
    id
    description
    confidenceScore
  }
}
