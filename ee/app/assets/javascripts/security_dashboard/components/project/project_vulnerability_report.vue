<script>
import { GlAlert } from '@gitlab/ui';
import { s__ } from '~/locale';
import VulnerabilityRetentionAlert from '../shared/vulnerability_retention_alert.vue';
import VulnerabilityReportTabs from '../shared/vulnerability_report/vulnerability_report_tabs.vue';
import ProjectPipelineStatus from '../shared/project_pipeline_status.vue';

const VULNERABILITY_QUOTA = {
  critical: s__(
    'SecurityReports|This project is reaching the maximum number of vulnerabilities it can contain.',
  ),
  full: s__(
    'SecurityReports|This project has reached the maximum number of vulnerabilities it can contain. New vulnerabilities will not be created.',
  ),
  exceeded: s__(
    "SecurityReports|This project has reached the maximum number of vulnerabilities it can contain and some of the vulnerabilities couldn't be ingested.",
  ),
};

export default {
  components: {
    ProjectPipelineStatus,
    VulnerabilityReportTabs,
    GlAlert,
    VulnerabilityRetentionAlert,
  },
  inject: ['pipeline', 'sbomPipeline', 'vulnerabilityQuota'],
  computed: {
    quotaWarning() {
      return VULNERABILITY_QUOTA[this.vulnerabilityQuota];
    },
    shouldShowPipelineStatus() {
      return this.pipeline.createdAt && this.pipeline.id && this.pipeline.path;
    },
  },
};
</script>

<template>
  <div>
    <gl-alert
      v-if="quotaWarning"
      title="Warning"
      variant="warning"
      class="gl-mt-5"
      :dismissible="false"
    >
      {{ quotaWarning }}
    </gl-alert>

    <vulnerability-retention-alert />

    <vulnerability-report-tabs>
      <template #header-development>
        <project-pipeline-status
          v-if="shouldShowPipelineStatus"
          :pipeline="pipeline"
          :sbom-pipeline="sbomPipeline"
        />
      </template>
    </vulnerability-report-tabs>
  </div>
</template>
