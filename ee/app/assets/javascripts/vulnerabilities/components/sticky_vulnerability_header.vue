<script>
import { GlIntersectionObserver, GlLink } from '@gitlab/ui';
import SafeHtml from '~/vue_shared/directives/safe_html';
import StatusBadge from 'ee/vue_shared/security_reports/components/status_badge.vue';
import { __ } from '~/locale';

export default {
  name: 'StickyVulnerabilityHeader',
  components: {
    StatusBadge,
    GlIntersectionObserver,
    GlLink,
  },
  directives: {
    SafeHtml,
  },
  props: {
    tabs: {
      type: Array,
      required: true,
    },
    vulnerability: {
      type: Object,
      required: true,
    },
  },
  data() {
    return {
      isStickyHeaderVisible: false,
    };
  },
  methods: {
    setStickyHeaderVisible(val) {
      this.isStickyHeaderVisible = val;
    },
    navigateTo(tabName, index) {
      if (index === this.tabIndex) {
        return;
      }
      this.$router.push({ path: '/', query: { tab: tabName } });
    },
  },
  safeHtmlConfig: {
    ADD_TAGS: ['gl-emoji'],
  },
  i18n: {
    active: __('Active'),
  },
};
</script>

<template>
  <gl-intersection-observer
    class="gl-relative -gl-top-5 gl-z-200"
    @appear="setStickyHeaderVisible(false)"
    @disappear="setStickyHeaderVisible(true)"
  >
    <div
      data-testid="sticky-header"
      class="issue-sticky-header gl-fixed gl-bg-white gl-border-b"
      :class="{ 'gl-invisible': !isStickyHeaderVisible }"
    >
      <div
        class="issue-sticky-header-text gl-flex gl-flex-col gl-items-center gl-mx-auto gl-w-full container-limited gl-pt-4"
      >
        <div class="gl-w-full gl-flex gl-items-center gl-gap-2">
          <status-badge :state="vulnerability.state" class="gl-mr-3" />
          <gl-link
            v-safe-html:[$options.safeHtmlConfig]="vulnerability.title"
            href="#top"
            class="gl-hidden lg:gl-block gl-font-bold gl-overflow-hidden gl-whitespace-nowrap gl-text-ellipsis gl-my-0 gl-ml-1 gl-mr-2 gl-text-gray-900"
          />
        </div>
        <div class="gl-w-full gl-flex">
          <ul
            class="merge-request-tabs nav-tabs nav nav-links gl-flex gl-flex-nowrap gl-m-0 gl-p-0 gl-border-b-0"
          >
            <li
              v-for="(tab, index) in tabs"
              :key="tab[0]"
              :class="{ active: tab[2] === `${$options.i18n.active}` }"
            >
              <gl-link
                href="#top"
                :data-action="tab[0]"
                class="!gl-py-4"
                @click="navigateTo(tab[0], index)"
              >
                {{ tab[1] }}
              </gl-link>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </gl-intersection-observer>
</template>
