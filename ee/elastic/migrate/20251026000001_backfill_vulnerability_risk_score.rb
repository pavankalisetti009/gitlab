# frozen_string_literal: true

class BackfillVulnerabilityRiskScore < ::Search::Elastic::MigrationReindexBasedOnSchemaVersion
  include ::Search::Elastic::MigrationDatabaseBackfillHelper

  batched!
  throttle_delay 1.minute
  retry_on_failure

  DOCUMENT_TYPE = ::Vulnerability

  # Skip on self-managed deployments where ES advanced search may not be configured
  skip_if -> { !::Gitlab.com? && !::Gitlab.dedicated? }

  def item_to_preload
    [{ finding: :finding_risk_score }]
  end
end
